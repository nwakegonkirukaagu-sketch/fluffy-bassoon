<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

  <title>YouCanHeal ‚Äî Welcome</title>

  <!-- Content Security Policy -->
  <meta http-equiv="Content-Security-Policy"
    content="
      default-src 'self';
      script-src 'self' https://cdn.jsdelivr.net https://*.supabase.co https://www.paypal.com;
      style-src 'self' 'unsafe-inline';
      img-src 'self' data:;
      connect-src https://*.supabase.co;
    ">

  <link rel="icon" href="images/youcanheal-logo.png" />

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- PayPal -->
  <script src="https://www.paypal.com/sdk/js?client-id=AeAkNJQMO6eiYY-v0IsWHNm64M3nHUnFaqKZ0iICehGrAVufHv1c3DGLNPXRkbKjjTJ_0cjN0Slc5tZz&vault=true&intent=subscription"></script>

  <style>
    /* ---------- ROOT ---------- */
    :root {
      --text: #1f2937;
      --muted: #6b7280;
      --button: #3b82f6;
      --button-hover: #2563eb;
    }

    body {
      margin: 0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: url("images/youcanheal-bg.png") center / cover no-repeat;
    }

    /* ---------- MOBILE FIX ---------- */
    @media (max-width: 768px) {
      body {
        background-attachment: scroll;
        padding: 12px;
      }
    }

    /* ---------- LOGIN CARD ---------- */
    .login-box {
      width: 100%;
      max-width: 420px;
      background: rgba(255,255,255,0.9);
      border-radius: 20px;
      padding: 32px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.25);
      text-align: center;
    }

    h1 {
      margin: 0;
      color: #8fbfa8;
      font-size: 1.8rem;
    }

    .subtitle {
      margin: 8px 0 20px;
      color: var(--muted);
    }

    input {
      width: 100%;
      padding: 14px;
      border-radius: 10px;
      border: 1px solid #ddd;
      font-size: 1rem;
      margin-bottom: 10px;
    }

    button {
      width: 100%;
      padding: 14px;
      border-radius: 10px;
      border: none;
      font-size: 1rem;
      background: var(--button);
      color: #fff;
      cursor: pointer;
    }

    button:hover {
      background: var(--button-hover);
    }

    .consent {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.9rem;
      color: var(--muted);
      margin-bottom: 12px;
    }

    .message {
      margin-top: 10px;
      font-size: 0.9rem;
    }

    /* ---------- COOKIE ---------- */
    #cookie-banner {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(30,41,59,0.95);
      color: #fff;
      padding: 10px;
      text-align: center;
      font-size: 0.85rem;
      z-index: 100;
      padding-bottom: env(safe-area-inset-bottom);
    }

    #cookie-banner button {
      margin-left: 8px;
      padding: 4px 10px;
      background: #facc15;
      color: #000;
      border-radius: 6px;
      border: none;
      cursor: pointer;
    }
  </style>

  <!-- Supabase config -->
  <script>
    window.SUPABASE_URL = "https://hrpxfnrizypnqwsiasqw.supabase.co";
    window.SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhycHhmbnJpenlwbnF3aWFzcXciLCJyb2xlIjoiYW5vbiIsImlhdCI6MTc1OTAwNjUyNSwiZXhwIjoyMDc0NTgyNTI1fQ.4btbG22BF7WWtCvq1Du7Bo0aLcKHZIUV4MBwPQW53eY";
  </script>
</head>

<body>

  <div class="login-box">
    <h1>Welcome to YouCanHeal</h1>
    <p class="subtitle">Your gentle wellbeing companion üå∑</p>

    <form id="loginForm">
      <input type="email" id="email" placeholder="Enter your email" required />

      <label class="consent">
        <input type="checkbox" id="consent" />
        I consent to store non-sensitive data
      </label>

      <button type="submit">Send Magic Link</button>
      <div id="msg" class="message"></div>
    </form>
  </div>

  <!-- Cookie -->
  <div id="cookie-banner" style="display:none;">
    üç™ We use cookies to improve your experience.
    <button id="cookie-ok">OK</button>
  </div>

  <script type="module">
    const supabase = window.supabase.createClient(
      window.SUPABASE_URL,
      window.SUPABASE_ANON_KEY
    );

    const form = document.getElementById("loginForm");
    const msg = document.getElementById("msg");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      msg.textContent = "";

      if (!document.getElementById("consent").checked) {
        msg.textContent = "Please accept consent.";
        return;
      }

      const email = document.getElementById("email").value.trim();

      const { error } = await supabase.auth.signInWithOtp({
        email,
        options: {
          emailRedirectTo: "https://youcanheal.co.uk/dashboard.html"
        }
      });

      if (error) {
        msg.textContent = "Unable to send link. Try again.";
      } else {
        msg.textContent = "Magic link sent! Check your email.";
      }
    });

    // Cookie banner
    const banner = document.getElementById("cookie-banner");
    if (!localStorage.getItem("yc_cookie")) {
      banner.style.display = "block";
      document.getElementById("cookie-ok").onclick = () => {
        localStorage.setItem("yc_cookie", "1");
        banner.remove();
      };
    }
  </script>

</body>
</html>
